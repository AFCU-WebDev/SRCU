@model IEnumerable<SRCUBagTracking.Models.Bag>

@{
    ViewBag.Title = "School Bag";
    WebGrid grid = new WebGrid(Model, canPage: true, rowsPerPage: 25);
    grid.Pager(WebGridPagerModes.All);
}
@Html.Partial("_AdminNavigation")
<div class="col-md-12">
    <br />
    <div class="col-md-push-4 col-md-6 margin-left "> <h2>@ViewBag.schoolName School Bag</h2> </div><br />  <br />
   <br /><br />
    <div class="col-md-1 margin-left"><a href="@Url.Action("AddBag", "Admin", new { schoolId = @ViewBag.SchoolId })" type="button" class="btn btn-primary pull-right">Add New Bag</a></div>
    <div class="col-md-10 margin-left"><a href="@Url.Action("SchoolProfile", "Admin", new { schoolId = @ViewBag.SchoolId })" type="button" class="btn btn-primary pull-right">School Profile</a></div><br /><br />
    </div>
    <div id="grid" class="col-md-12">
        @{
            @grid.GetHtml(@*htmlAttributes: new { id = "DataTable" },*@
                                                 tableStyle: "webgrid-table",
                                                 headerStyle: "webgrid-header",
                                                 footerStyle: "webgrid-footer",
                                                 //alternatingRowStyle: "webgrid-alternating-row",
                                                 rowStyle: "webgrid-row-style",
                                                 columns: grid.Columns(
                                                 // grid.Column("recid", "ID"),
                                                 grid.Column("dateSubmitted", "Date Submitted"),
                                                 grid.Column("bagNumber", "Bags #", canSort: false),
                                                 grid.Column("deposits", "Deposits #", canSort: false),
                                                 grid.Column("dateCompletedDeposits", "Deposits Completed", canSort: false),
                                                 grid.Column("memberApps", "Apps #", canSort: false),
                                                 grid.Column("dateCompletedApps", "Apps Completed", canSort: false),
                                                 grid.Column("dollarAmount", "$ Amount", canSort: false, format: (item) => item.dollarAmount != null ? item.dollarAmount.ToString("#,#.00") : ""),
                                                 grid.Column("completedByTeller", "Teller ID", canSort: false),
                                                 grid.Column("handDeliver", "HD"),
                                                 grid.Column(header: "Comments", style: "action", format: @<text> @Html.ActionLink("Read", "AdminComments", new { recId = item.rec_ID, schoolId = item.school_ID }, new { data_toggle = "modal", data_target = "#CommentModal" })
                                                 &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
                                                 @if (@item.liasonComment != null && @item.liasonComment != "")
                                                 {
                                                     <img src="~/Content/img/icons/sendComment.png" width="18" />
                                                 }
                                                 else
                                                 {
                                                     <span>&nbsp; &nbsp;&nbsp;</span>
                                                 }
                                          
                                                 @if (@item.branchComment != null && @item.branchComment != "")
                                                 {
                                                     <span>&nbsp;   </span>  <img src="~/Content/img/icons/chatbubbles.png" width="21" />
                                                 }
                                                 </text>),
                                                 grid.Column(header: "Action", format: @<text>
                                                 @Html.ActionLink("Edit |", "UpdateBag", new { recId = item.rec_ID })
                                                 @Html.ActionLink(" Delete", "DeleteBag", new { recId = item.rec_ID, schoolId = item.school_ID }, new { data_toggle = "modal", data_target = "#DeleteModal" }) </text>)
                                          
                                                                   ));
        }

    </div>

    <!-- COMMENT Modal -->
    <div class="modal fade bs-example-modal-lg" id="CommentModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">SRCU Comments</h4>
                </div>
                <div class="modal-body">

                </div>
            </div>
        </div>
    </div>

    <!--DELETE Modal -->
    <div class="modal fade" id="DeleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    @* <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>*@
                    <h4 class="modal-title" id="myModalLabel">Delete Alert</h4>
                </div>
                <div class="modal-body">
                    <h4>Are you sure you want to delete this bag?</h4>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            $("#grid tbody tr").each(function (i, row) {
                var bagNumber = $(this).find("td:nth-child(2)").text();
                var deposit = $(this).find("td:nth-child(3)").text();
                var appNumber = $(this).find("td:nth-child(5)").text();
                var handDeliver = $(this).find("td:nth-child(9)").html();
                //hiding HandDelivered column
                $('table th:nth-child(9), table td:nth-child(9)').hide();


                if (deposit == 0 && (appNumber.length == 0 || appNumber == 0)) {
                    $(this).addClass("grey_Background grey");
                    $(this).find(".action a").remove();
                    $(this).find("img").remove();
                }
                else if (handDeliver == "True") {
                    $(this).addClass("lightBrownOrange_Background darkgrey");                                     
                }
                else if (deposit == 0 && (appNumber.length != 0 || appNumber!=0)) {
                    $(this).addClass("lightBlue_Background white");
                }

                else {
                    $(this).addClass("white_Background darkgrey");
                }
            });

            $('#CommentModal').click(function () {
                location.reload(true);
            });
        });
    </script>
