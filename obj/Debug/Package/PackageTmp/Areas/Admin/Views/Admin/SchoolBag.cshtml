@model IEnumerable<SRCUBagTracking.Models.Bag>

@{
    ViewBag.Title = "School Bag";
    WebGrid grid = new WebGrid(Model, canPage: true, rowsPerPage: 25);
    grid.Pager(WebGridPagerModes.All);
}
@Html.Partial("_AdminNavigation")

<div class="m-5">

    <a href="@Url.Action("SchoolProfile", "Admin", new { schoolId = @ViewBag.SchoolId })" type="button" class="btn btn-link">  <h2 class="page-header text-decoration-ul">@ViewBag.schoolName School Bag <i class="fas fa-caret-right"></i></h2></a> <hr />

    <div class="row justify-content-between mb-5 mt-5">
        <div class="mr-5 ml-3 col-2 col-md-2 col-lg-2 col-xl-bootstrap 4.6 2"><a href="@Url.Action("AddBag", "Admin", new { schoolId = @ViewBag.SchoolId })" type="button" class="btn CTA_btn">Add New Bag</a></div>
        <div class="ml-5 ">
            <table class=" mr-3">
                <tr>

                    <td class="p-2 white_Background red bold border-0">Table Color Guide:</td>
                    <td class="p-2 lightGreen_bg">Yes Deposit, Yes App </td>
                    <td class="p-2 lightBlue_bg">No Deposit, Yes App </td>
                    <td class="p-2 lightYellow-bg">Hand Delivered </td>
                    <td class="p-2 grey_Background">No Bag</td>
                </tr>
            </table>
        </div>
    </div>

    <div id="grid">
        @{
            @grid.GetHtml(@*htmlAttributes: new { id = "DataTable" },*@
tableStyle: "table",
headerStyle: "webgrid-header",
footerStyle: "webgrid-footer",
//alternatingRowStyle: "webgrid-alternating-row",
rowStyle: "webgrid-row-style",
columns: grid.Columns(
// grid.Column("recid", "ID"),
grid.Column("dateSubmitted", "Date Submitted"),
grid.Column("bagNumber", "Bags #", canSort: false),
grid.Column("deposits", "Deposits #", canSort: false),
grid.Column("dateCompletedDeposits", "Deposits Completed", canSort: false),
grid.Column("memberApps", "Apps #", canSort: false),
grid.Column("dateCompletedApps", "Apps Completed", canSort: false),
grid.Column("dollarAmount", "$ Amount", canSort: false, format: (item) => item.dollarAmount != null ? item.dollarAmount.ToString("#,#.00") : ""),
grid.Column("completedByTeller", "Teller ID", canSort: false),
grid.Column("handDeliver", "HD"),
grid.Column("liasonComment", "Liaison Comment", canSort: false),
grid.Column("branchComment", "Branch Comment", canSort: false),

@*grid.Column(header: "Comments", style: "action", format: @<text> @Html.ActionLink("Read", "AdminComments", new { recId = item.rec_ID, schoolId = item.school_ID }, new { data_toggle = "modal", data_target = "#CommentModal" })
                                                             &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
@if (@item.liasonComment != null && @item.liasonComment != "")
     {
    <img src="~/Content/img/icons/sendComment.png" width="18" />
     }
     else
     {
    <span>&nbsp; &nbsp;&nbsp;</span>
     }

@if (@item.branchComment != null && @item.branchComment != "")
     {
    <span>&nbsp;   </span> <img src="~/Content/img/icons/chatbubbles.png" width="21" />
     }
</text>),*@
grid.Column(header: "Action", format: @<text>
    @Html.ActionLink("Edit", "UpdateBag", new { recId = item.rec_ID })
    @*@Html.ActionLink("| Delete", "DeleteBag", new { recId = item.rec_ID, schoolId = item.school_ID }, new { data_toggle = "modal", data_target = "#DeleteModal" })*@ </text>)

));
        }

    </div>
</div>

<!-- COMMENT Modal -->
<div class="modal fade" id="CommentModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">SRCU Comments</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                @Html.Partial("_Comments")
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>

<!--DELETE Modal -->
<div class="modal fade" id="DeleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" >
        <div class="modal-content">
            <div class="modal-header">
                @* <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>*@
                <h4 class="modal-title catalinaBlue" id="myModalLabel">Delete Alert</h4>
            </div>
            <div class="modal-body">
                <h4>Are you sure you want to delete this bag?</h4>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-outline-danger">Delete</button>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $("#grid tbody tr").each(function (i, row) {
            var bagNumber = $(this).find("td:nth-child(2)").text();
            var deposit = $(this).find("td:nth-child(3)").text();
            var appNumber = $(this).find("td:nth-child(5)").text();
            var handDeliver = $(this).find("td:nth-child(9)").html();
            //hiding HandDelivered column
            $('table th:nth-child(9), table td:nth-child(9)').hide();


            if (deposit == 0 && (appNumber.length == 0 || appNumber == 0)) {
                $(this).addClass("grey_Background darkgrey");
                $(this).find(".action a").remove();
                $(this).find("img").remove();
            }           
            else if (deposit == 0 && (appNumber.length != 0 || appNumber != 0)) {
                $(this).addClass("lightBlue_bg darkgrey");
            }
            else if (handDeliver == "True") {
                $(this).addClass("lightYellow-bg darkgrey");
            }

            else {
                $(this).addClass("lightGreen_bg darkgrey");
            }
        });

        $('#CommentModal').click(function () {
            location.reload(true);
        });
    });
</script>
